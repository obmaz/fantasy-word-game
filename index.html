<!doctype html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>ÌÇπÏôïÏß± RPG</title>
        <link rel="stylesheet" href="styles/variables.css" />
        <link rel="stylesheet" href="styles/animations.css" />
        <link rel="stylesheet" href="styles/title-screen.css" />
        <link rel="stylesheet" href="styles/battle-mode-game.css" />
        <link rel="stylesheet" href="styles/modal-common.css" />
        <link rel="stylesheet" href="styles/practice-mode-modal.css" />
        <link rel="stylesheet" href="styles/battle-mode-modal.css" />
        <link rel="stylesheet" href="styles/practice-mode-game.css" />
        <link rel="stylesheet" href="styles/battle-mode-story-modal.css" />
        <link rel="stylesheet" href="styles/buttons.css" />
        <link rel="stylesheet" href="styles/shop-modal.css" />
        <link rel="stylesheet" href="styles/inventory-modal.css" />
        <link rel="stylesheet" href="styles/statistics-modal.css" />
        <link rel="stylesheet" href="styles/setting-modal.css" />
        <link rel="stylesheet" href="styles/result-modal.css" />
    </head>

    <body>
        <div id="battle-mode-game" style="display: none; height: 100%; flex-direction: column">
            <div class="battle-arena">
                <div class="info-badge" id="wave-badge">Wave: 1</div>
                <div class="info-badge" id="game-info-badge">Î∞∞ÌãÄ Î™®Îìú - Day 1</div>
                <div class="durability-badge" id="durability-badge">ü•ä 30/30</div>
                <!-- Î∞∞Í≤Ω ÏúÑÏóê Í≥®ÎìúÏôÄ ÏãúÍ∞Ñ ÌëúÏãú -->
                <div class="overlay-gold">üí∞ <span id="overlay-gold">0</span> G</div>
                <div class="overlay-timer">
                    <div class="timer-bar-bg">
                        <div id="overlay-timer" class="timer-bar-fill"></div>
                    </div>
                </div>

                <div class="char-wrapper" id="hero-wrapper">
                    <div id="hero-head" class="hero-equip-slot"></div>
                    <div id="hero-hand-1" class="hero-equip-slot"></div>
                    <div id="hero-hand-2" class="hero-equip-slot"></div>
                    <div id="hero-feet" class="hero-equip-slot"></div>
                    <img id="hero-img" class="char-img" src="" alt="Hero" />
                    <div id="hero-weapon" class="equipped-weapon"></div>
                    <div id="hero-effect" class="hero-effect" style="display: none"></div>
                </div>

                <div class="effect-layer">
                    <div id="effect-slash"></div>
                    <div id="effect-void-bg" class="slash-void-bg"></div>
                    <div id="effect-void-core" class="slash-void-core"></div>
                </div>

                <div class="char-wrapper">
                    <img id="monster-img" class="char-img" src="" alt="Monster" />
                </div>
                <div id="dmg-txt" class="damage-txt"></div>
                <!-- ÎÇòÍ∞ÄÍ∏∞: ÏïÑÎ†àÎÇò Ïö∞ÌïòÎã® -->
                <div class="practice-arena-exit-wrap">
                    <button type="button" class="practice-nav-btn practice-nav-exit" id="battle-exit-btn" title="ÎÇòÍ∞ÄÍ∏∞">ÎÇòÍ∞ÄÍ∏∞</button>
                </div>
            </div>

            <div class="quiz-area">
                <div class="question-box">
                    <div class="q-label" id="q-label">MEANING</div>
                    <div class="q-text" id="q-text">Loading...</div>
                </div>

                <div id="skill-display" class="skill-bar"></div>

                <div id="options-box" class="options-grid"></div>

                <div id="boss-box" class="boss-ui">
                    <div
                        style="text-align: center; color: #ff5252; font-weight: bold"
                        id="boss-title"
                    >
                        ‚ö†Ô∏è FINAL BOSS
                    </div>
                    <div id="boss-hint" class="boss-hint"></div>
                    <input
                        type="text"
                        id="boss-input"
                        class="boss-input"
                        placeholder="Ï†ïÎãµ ÏûÖÎ†•"
                        autocomplete="off"
                    />
                    <button class="boss-submit" onclick="game.checkBossAnswer()">Í≥µÍ≤©ÌïòÍ∏∞</button>
                </div>
            </div>
        </div>

        <div id="title-screen" class="screen-overlay">
            <!-- Title container - constrains buttons within image bounds -->
            <div class="title-container-wrapper">
                <!-- Game title header image (randomly loaded) -->
                <img
                    id="title-header-img"
                    src="images/title/title_header_1.webp"
                    alt="Game Title"
                    class="title-header"
                />
                <!-- Background image - displayed vertically centered, full height visible -->
                <img src="images/title/title.webp" alt="Title Screen" class="title-background" />

                <!-- Button overlay - matches image size exactly -->
                <div class="title-buttons-overlay">
                    <!-- Gold display on title screen -->
                    <div class="title-gold-display">üí∞ <span id="title-ui-gold">0</span> G</div>
                    <!-- Game Data Selector (options are dynamically populated by data-loader.js) -->
                    <select
                        id="game-data-selector"
                        class="title-data-selector"
                        title="Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ ÏÑ†ÌÉù"
                    >
                        <option value="1">Îä•Î•† Î≥¥Ïπ¥ Ï§ëÎì± Í∏∞Î≥∏</option>
                        <option value="2">ÏõåÎìú ÎßàÏä§ÌÑ∞ Ï§ëÎì± Í≥†ÎÇúÎèÑ</option>
                    </select>
                    <!-- Interactive button areas (invisible overlays on image buttons) -->
                    <!-- PRACTICE MODE = Ïó∞Ïäµ Î™®Îìú -->
                    <button
                        class="title-btn-area content-visible"
                        id="title-practice-btn"
                        title="Ïó∞Ïäµ Î™®Îìú (PRACTICE MODE)"
                    >
                        <img
                            src="images/title/practice_mode_btn.webp"
                            alt="Practice Mode"
                            class="btn-image"
                        />
                        <span class="button-text">Ïó∞ÏäµÎ™®Îìú</span>
                    </button>
                    <!-- BATTLE MODE = Î∞∞ÌãÄ Î™®Îìú -->
                    <button
                        class="title-btn-area content-visible"
                        id="title-battle-mode-btn"
                        title="Î∞∞ÌãÄ Î™®Îìú (BATTLE MODE)"
                    >
                        <img
                            src="images/title/battle_mode_btn.webp"
                            alt="Battle Mode"
                            class="btn-image"
                        />
                        <span class="button-text">Î∞∞ÌãÄÎ™®Îìú</span>
                    </button>
                    <!-- BOSS MODE = Î¨¥ÌïúÏùò Ï†ÑÏû• -->
                    <button
                        class="title-btn-area content-visible"
                        id="title-boss-mode-btn"
                        title="Î¨¥ÌïúÏùò Ï†ÑÏû• (BOSS MODE)"
                    >
                        <img
                            src="images/title/boss_mode_btn.webp"
                            alt="Boss Mode"
                            class="btn-image"
                        />
                        <span class="button-text">Î≥¥Ïä§Î™®Îìú</span>
                    </button>

                    <!-- shop = ÏÉÅÏ†ê -->
                    <button
                        class="title-btn-area content-visible"
                        id="title-shop-btn"
                        title="ÏÉÅÏ†ê (SHOP)"
                    >
                        <img src="images/title/shop_btn.webp" alt="Shop" class="btn-image" />
                    </button>
                    <!-- inventory = Ïù∏Î≤§ÌÜ†Î¶¨ -->
                    <button
                        class="title-btn-area content-visible"
                        id="title-inventory-btn"
                        title="Ïù∏Î≤§ÌÜ†Î¶¨ (INVENTORY)"
                    >
                        <img
                            src="images/title/inventory_btn.webp"
                            alt="Inventory"
                            class="btn-image"
                        />
                    </button>
                    <!-- statistics = ÌÜµÍ≥Ñ -->
                    <button
                        class="title-btn-area content-visible"
                        id="title-statistics-btn"
                        title="ÌÜµÍ≥Ñ (STATISTICS)"
                    >
                        <img
                            src="images/title/statistics_btn.webp"
                            alt="Statistics"
                            class="btn-image"
                        />
                    </button>
                    <!-- ÏùºÎ∞òÏÑ§Ï†ï Î©îÎâ¥ -->
                    <button
                        class="title-btn-area content-visible"
                        id="title-setting-btn"
                        title="ÏùºÎ∞òÏÑ§Ï†ï (SETTING)"
                    >
                        <img
                            src="images/title/settings_btn.webp"
                            alt="Settings"
                            class="btn-image"
                        />
                    </button>
                </div>
            </div>

            <!-- Hidden UI elements (kept for functionality but not displayed) -->
            <div style="display: none">
                <div class="stats-box" id="stat-solved">0</div>
                <div class="stat-item" id="stat-correct">0</div>
                <div class="stat-item" id="stat-rate">0%</div>
                <div id="equipped-summary" class="equipped-summary"></div>
                <select id="day-select"></select>
                <select id="count-select">
                    <option value="10" selected>10 ÎßàÎ¶¨ (Î≥¥ÌÜµ)</option>
                    <option value="20">20 ÎßàÎ¶¨ (Ïñ¥Î†§ÏõÄ)</option>
                    <option value="all">Î™®Îì† Î¨∏Ï†ú</option>
                </select>
            </div>

            <!-- Hidden buttons for functionality (kept for event listeners) -->
            <button class="btn-main" id="start-battle-btn" style="display: none">
                Ï†ÑÌà¨ ÏãúÏûë ‚öîÔ∏è
            </button>
            <button class="btn-main btn-boss-mode" id="boss-mode-btn" style="display: none">
                üî• Î≥¥Ïä§ Î™®Îìú (Î¨¥Ìïú)
            </button>
            <button class="btn-main btn-shop" onclick="shop.open()" style="display: none">
                ÏÉÅÏ†ê üõí
            </button>
            <button class="btn-main btn-inv" onclick="inventory.open()" style="display: none">
                Ïù∏Î≤§ÌÜ†Î¶¨ üéí
            </button>
        </div>

        <div id="inventory-modal" class="screen-overlay" style="display: none">
            <div class="card rpg-modal">
                <div id="inv-item-detail" style="display: none">
                    <div id="detail-header">
                        <div id="detail-icon"></div>
                        <div id="detail-name"></div>
                        <button id="detail-close" onclick="inventory.hideDetails()">X</button>
                    </div>
                    <div id="detail-desc"></div>
                    <div id="detail-actions"></div>
                </div>

                <div class="modal-header">
                    <h2 class="modal-title">Ïù∏Î≤§ÌÜ†Î¶¨</h2>
                </div>
                <div class="inv-container">
                    <div class="inv-player">
                        <!-- Head / hands / torso layout for "ÏÇ¨Îûå Î™®Ïñë" Ïä¨Î°Ø -->
                        <div class="inv-head" style="margin-bottom: 8px">
                            <div
                                class="inv-slot"
                                id="inv-head"
                                role="button"
                                tabindex="0"
                                aria-label="Î®∏Î¶¨ Ïä¨Î°Ø"
                                onclick="inventory.unequip('head')"
                            ></div>
                        </div>

                        <div class="inv-body">
                            <div
                                class="inv-slot"
                                id="inv-hand-2"
                                role="button"
                                tabindex="0"
                                aria-label="ÏôºÏÜê Ïä¨Î°Ø"
                                onclick="inventory.unequip('hand-2')"
                            ></div>
                            <div class="inv-torso">
                                <div
                                    class="inv-slot"
                                    id="inv-weapon"
                                    role="button"
                                    tabindex="0"
                                    aria-label="Î¨¥Í∏∞ Ïä¨Î°Ø"
                                    onclick="inventory.unequip('weapon')"
                                ></div>
                            </div>
                            <div
                                class="inv-slot"
                                id="inv-hand-1"
                                role="button"
                                tabindex="0"
                                aria-label="Ïò§Î•∏ÏÜê Ïä¨Î°Ø"
                                onclick="inventory.unequip('hand-1')"
                            ></div>
                        </div>

                        <div class="inv-legs">
                            <div
                                class="inv-slot"
                                id="inv-foot-1"
                                role="button"
                                tabindex="0"
                                aria-label="ÏôºÎ∞ú Ïä¨Î°Ø"
                                onclick="inventory.unequip('foot-1')"
                            ></div>
                            <div
                                class="inv-slot"
                                id="inv-foot-2"
                                role="button"
                                tabindex="0"
                                aria-label="Ïò§Î•∏Î∞ú Ïä¨Î°Ø"
                                onclick="inventory.unequip('foot-2')"
                            ></div>
                        </div>
                    </div>
                    <div class="inv-storage">
                        <h3 class="inv-section-title">Î≥¥Í¥ÄÌï® (Ïû•ÎπÑ)</h3>
                        <div class="inv-items"></div>
                        <div class="inv-capacity">
                            Ïö©Îüâ: <span id="inv-cap">0</span> / <span id="inv-max-cap">3</span>
                        </div>

                        <h3 class="inv-section-title" style="margin-top: 16px">Î≥¥Ïú† Ïú†Î¨º</h3>
                        <div class="inv-relics"></div>
                    </div>
                </div>
                <img
                    id="inv-close-btn"
                    src="images/title/exit_btn.webp"
                    alt="ÎÇòÍ∞ÄÍ∏∞"
                    onclick="inventory.close()"
                    aria-label="Ïù∏Î≤§ÌÜ†Î¶¨ Îã´Í∏∞"
                    style="
                        width: 80%;
                        height: auto;
                        display: block;
                        margin: 0 auto;
                        cursor: pointer;
                        object-fit: contain;
                    "
                />
            </div>
        </div>

        <!-- Practice Mode Selection Modal -->
        <div id="practice-mode-modal" class="screen-overlay" style="display: none">
            <div class="modal-container-wrapper">
                <img
                    src="images/practice_mode/practice_mode_select_popup .webp"
                    alt="Practice Mode Settings"
                    class="modal-background"
                    id="practice-mode-modal-background-img"
                />
                <div class="modal-buttons-overlay">
                    <!-- Î™®Îã¨ ÌÉÄÏù¥ÌãÄ -->
                    <div class="modal-title">Ïó∞ÏäµÎ™®Îìú</div>

                    <!-- Î™®Ìóò ÏßÄÏó≠ ÎìúÎ°≠Î∞ïÏä§ ÏòÅÏó≠ -->
                    <select
                        id="practice-mode-modal-day-select"
                        class="modal-select modal-day-select"
                    ></select>

                    <!-- ÎÇúÏù¥ÎèÑ ÎìúÎ°≠Î∞ïÏä§ ÏòÅÏó≠ -->
                    <select
                        id="practice-mode-modal-count-select"
                        class="modal-select modal-count-select"
                    >
                        <option value="10" selected>10 ÎßàÎ¶¨ (Î≥¥ÌÜµ)</option>
                        <option value="20">20 ÎßàÎ¶¨ (Ïñ¥Î†§ÏõÄ)</option>
                        <option value="all">Î™®Îì† Î¨∏Ï†ú</option>
                    </select>

                    <!-- ÏãúÏûëÌïòÍ∏∞ Î≤ÑÌäº ÏòÅÏó≠ -->
                    <button
                        class="modal-btn-area"
                        id="practice-mode-modal-start-btn"
                        title="ÏãúÏûëÌïòÍ∏∞"
                    ></button>

                    <!-- Ï∑®ÏÜå Î≤ÑÌäº ÏòÅÏó≠ -->
                    <button
                        class="modal-btn-area"
                        id="practice-mode-modal-cancel-btn"
                        title="Ï∑®ÏÜå"
                    ></button>
                </div>
            </div>
        </div>

        <!-- Battle Mode Selection Modal -->
        <div id="battle-mode-modal" class="screen-overlay" style="display: none">
            <div class="modal-container-wrapper">
                <img
                    src="images/battle_mode/battle-mode-modal.webp"
                    alt="Battle Mode Settings"
                    class="modal-background"
                    id="battle-mode-modal-background-img"
                />
                <div class="modal-buttons-overlay">
                    <!-- Î™®Ìóò ÏßÄÏó≠ ÎìúÎ°≠Î∞ïÏä§ ÏòÅÏó≠ -->
                    <select
                        id="battle-mode-modal-day-select"
                        class="modal-select modal-day-select"
                    ></select>

                    <!-- ÎÇúÏù¥ÎèÑ ÎìúÎ°≠Î∞ïÏä§ ÏòÅÏó≠ -->
                    <select
                        id="battle-mode-modal-count-select"
                        class="modal-select modal-count-select"
                    >
                        <option value="10" selected>10 ÎßàÎ¶¨ (Î≥¥ÌÜµ)</option>
                        <option value="20">20 ÎßàÎ¶¨ (Ïñ¥Î†§ÏõÄ)</option>
                        <option value="all">Î™®Îì† Î¨∏Ï†ú</option>
                    </select>

                    <!-- Î¨∏Ï†ú ÌÉÄÏûÖ ÎùºÎîîÏò§ Î≤ÑÌäº (Battle Mode Ï†ÑÏö©) -->
                    <div id="battle-mode-modal-question-type-group" class="modal-radio-group">
                        <label class="modal-radio-label">
                            <input
                                type="radio"
                                name="battle-question-type"
                                value="objective"
                                class="modal-radio"
                            />
                            <span class="modal-radio-text">Í∞ùÍ¥ÄÏãù</span>
                        </label>
                        <label class="modal-radio-label">
                            <input
                                type="radio"
                                name="battle-question-type"
                                value="mixed"
                                checked
                                class="modal-radio"
                            />
                            <span class="modal-radio-text">ÌòºÌï©Ìòï</span>
                        </label>
                        <label class="modal-radio-label">
                            <input
                                type="radio"
                                name="battle-question-type"
                                value="subjective"
                                class="modal-radio"
                            />
                            <span class="modal-radio-text">Ï£ºÍ¥ÄÏãù</span>
                        </label>
                    </div>

                    <!-- ÏãúÏûëÌïòÍ∏∞ Î≤ÑÌäº ÏòÅÏó≠ -->
                    <button
                        class="modal-btn-area"
                        id="battle-mode-modal-start-btn"
                        title="ÏãúÏûëÌïòÍ∏∞"
                    ></button>

                    <!-- Ï∑®ÏÜå Î≤ÑÌäº ÏòÅÏó≠ -->
                    <button
                        class="modal-btn-area"
                        id="battle-mode-modal-cancel-btn"
                        title="Ï∑®ÏÜå"
                    ></button>
                </div>
            </div>
        </div>

        <!-- Practice Mode Game (Îã®Ïñ¥ ÏïîÍ∏∞ ÌôîÎ©¥) -->
        <div id="practice-mode-game" style="display: none; height: 100%; flex-direction: column">
            <div class="practice-memorization-container">
                <!-- Î∞∞ÌãÄ ÏïÑÎ†àÎÇò ÏòÅÏó≠ (Î∞∞ÌãÄ Î™®ÎìúÏôÄ Ïú†ÏÇ¨) -->
                <div class="practice-memorization-arena">
                    <!-- ÏÉÅÎã®: Day Ï†ïÎ≥¥ Î∞è Îã®Ïñ¥ Î≤àÌò∏ -->
                    <div class="practice-memorization-header">
                        <div class="practice-day-info" id="practice-memorization-day-info"></div>
                        <div class="practice-word-counter" id="practice-word-counter">1 / 1</div>
                    </div>
                    <!-- ÎÇòÍ∞ÄÍ∏∞: ÏïÑÎ†àÎÇò Ïö∞ÌïòÎã® -->
                    <div class="practice-arena-exit-wrap">
                        <button type="button" class="practice-nav-btn practice-nav-exit" id="practice-exit-btn" title="ÎÇòÍ∞ÄÍ∏∞">ÎÇòÍ∞ÄÍ∏∞</button>
                    </div>
                </div>

                <!-- Ï§ëÏïô: Îã®Ïñ¥ ÌëúÏãú ÏòÅÏó≠ (Î∞∞ÌãÄ Î™®ÎìúÏùò quiz-areaÏôÄ Ïú†ÏÇ¨) -->
                <div class="practice-memorization-content">
                    <!-- ÏòÅÏñ¥ Îã®Ïñ¥ + ÏùåÏÑ± Ïû¨ÏÉù -->
                    <div class="practice-word-section">
                        <div class="practice-word-row">
                            <div class="practice-word-text" id="practice-word-text">Loading...</div>
                        </div>
                    </div>

                    <!-- ÌïúÍ∏Ä Îúª -->
                    <div class="practice-meaning-section">
                        <div class="practice-meaning-text" id="practice-meaning-text">
                            Loading...
                        </div>
                    </div>

                    <!-- ÏòÅÎ¨∏/ÌïúÍ∏Ä ÏÑ§Î™Ö (ÌÉ≠ÌïòÏó¨ Ï†ÑÌôò) -->
                    <div class="practice-explanation-section" id="practice-explanation-section" title="ÌÉ≠ÌïòÎ©¥ ÌïúÍ∏Ä/ÏòÅÎ¨∏ ÏÑ§Î™ÖÏúºÎ°ú Ï†ÑÌôòÎê©ÎãàÎã§">
                        <div class="practice-explanation-text" id="practice-explanation-text">
                            Loading...
                        </div>
                        <div class="practice-explanation-hint" aria-hidden="true">E ‚Üî Ìïú</div>
                    </div>
                </div>

                <!-- Ï¥àÏù¥Ïä§ Ïπ© + ÏùåÏÑ± ÏïÑÏù¥ÏΩò (Ìïú Ï§Ñ) -->
                <div id="practice-filter-chips" class="practice-memorized-row">
                    <button type="button" class="practice-chip practice-chip-active" data-filter="all">Ï†ÑÏ≤¥Î≥¥Í∏∞</button>
                    <button type="button" class="practice-chip" data-filter="memorized">Ïô∏Ïö¥Îã®Ïñ¥</button>
                    <button type="button" class="practice-chip" data-filter="not-memorized">Î™ªÏô∏Ïö¥Îã®Ïñ¥</button>
                    <button type="button" class="practice-speak-btn" id="practice-speak-btn" title="ÏùåÏÑ± Ïû¨ÏÉù" aria-label="ÏùåÏÑ± Ïû¨ÏÉù">üó£Ô∏è</button>
                </div>

                <!-- ÌïòÎã®: ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº (Ï§ëÏïô: Ïô∏Ïõ†Ïñ¥Ïöî) -->
                <div class="practice-memorization-navigation">
                    <button class="practice-nav-btn" id="practice-prev-btn" title="Ïù¥Ï†Ñ Îã®Ïñ¥">
                        ‚óÄ Ïù¥Ï†Ñ
                    </button>
                    <button type="button" class="practice-nav-btn practice-memorized-btn" id="practice-memorized-btn" title="Ïô∏Ïõ†Ïñ¥Ïöî">
                        Ïô∏Ïõ†Ïñ¥Ïöî
                    </button>
                    <button class="practice-nav-btn" id="practice-next-btn" title="Îã§Ïùå Îã®Ïñ¥">
                        Îã§Ïùå ‚ñ∂
                    </button>
                </div>
            </div>
        </div>

        <!-- Battle Mode Story Modal (battle Î™®ÎìúÏö©) - battle_mode_story_modal.webpÎ•º Ïä§ÌÜ†Î¶¨ Î™®Îã¨ Î∞∞Í≤ΩÏúºÎ°ú ÏÇ¨Ïö© -->
        <div id="battle-mode-story-modal" class="screen-overlay" style="display: none">
            <div class="story-container-wrapper">
                <img
                    src="images/battle_mode/battle_mode_story_modal.webp"
                    alt="Adventure Start"
                    class="story-background"
                    id="battle-mode-background-img"
                />
                <div class="story-buttons-overlay">
                    <!-- Î™®ÌóòÏãúÏûë Î≤ÑÌäº ÏòÅÏó≠ (Ïù¥ÎØ∏ÏßÄÏùò "Î™®Ìóò ÏãúÏûë" Î∂ÄÎ∂Ñ) -->
                    <button
                        class="story-btn-area"
                        id="battle-mode-start-btn"
                        title="Î™®Ìóò ÏãúÏûë"
                    ></button>
                </div>
                <!-- Day Ï†ïÎ≥¥ ÌëúÏãú ÏòÅÏó≠ -->
                <div class="story-day-info" id="battle-mode-day-info"></div>
                <!-- Ïù¥ÏïºÍ∏∞ ÌÖçÏä§Ìä∏ ÏòÅÏó≠ -->
                <div class="story-text-container">
                    <div class="story-text-content" id="battle-mode-text"></div>
                </div>
            </div>
        </div>

        <!-- Boss Mode Story Modal (ÎØ∏ÏÇ¨Ïö©: Î≥¥Ïä§Îäî Ïä§ÌÜ†Î¶¨ ÏóÜÏù¥ Î∞îÎ°ú Í≤åÏûÑ) -->
        <div id="boss-mode-story-modal" class="screen-overlay" style="display: none">
            <div class="story-container-wrapper">
                <img
                    src="images/battle_mode/battle_mode_story_modal.webp"
                    alt="Adventure Start"
                    class="story-background"
                    id="boss-mode-background-img"
                />
                <div class="story-buttons-overlay">
                    <!-- Î™®ÌóòÏãúÏûë Î≤ÑÌäº ÏòÅÏó≠ (Ïù¥ÎØ∏ÏßÄÏùò "Î™®Ìóò ÏãúÏûë" Î∂ÄÎ∂Ñ) -->
                    <button
                        class="story-btn-area"
                        id="boss-mode-start-btn"
                        title="Î™®Ìóò ÏãúÏûë"
                    ></button>
                </div>
                <!-- Day Ï†ïÎ≥¥ ÌëúÏãú ÏòÅÏó≠ -->
                <div class="story-day-info" id="boss-mode-day-info"></div>
                <!-- Ïù¥ÏïºÍ∏∞ ÌÖçÏä§Ìä∏ ÏòÅÏó≠ -->
                <div class="story-text-container">
                    <div class="story-text-content" id="boss-mode-text"></div>
                </div>
            </div>
        </div>

        <div id="shop-modal" class="screen-overlay" style="display: none">
            <div class="card rpg-modal">
                <div class="modal-header">
                    <h2 class="modal-title">ÏÉÅÏ†ê</h2>
                    <div style="font-size: 12px; color: var(--gold); margin-top: 4px; text-align: center;">Î≥¥Ïú† Í≥®Îìú: <span id="shop-gold">0</span> G</div>
                </div>
                <div class="modal-body">
                    <div id="shop-container" style="text-align: left"></div>
                </div>
                <div class="modal-footer">
                    <img
                        src="images/title/exit_btn.webp"
                        alt="ÎÇòÍ∞ÄÍ∏∞"
                        onclick="shop.close()"
                        style="
                            width: 80%;
                            height: auto;
                            display: block;
                            margin: 0 auto;
                            cursor: pointer;
                            object-fit: contain;
                        "
                    />
                </div>
            </div>
        </div>

        <div id="statistics-modal" class="screen-overlay" style="display: none">
            <div class="card rpg-modal">
                <div class="modal-header">
                    <h2 class="modal-title">ÌÜµÍ≥Ñ</h2>
                </div>
                <div class="modal-body">
                    <div id="statistics-container" style="text-align: left"></div>
                </div>
                <div class="modal-footer">
                    <img
                        src="images/title/exit_btn.webp"
                        alt="ÎÇòÍ∞ÄÍ∏∞"
                        onclick="statistics.close()"
                        style="
                            width: 80%;
                            height: auto;
                            display: block;
                            margin: 0 auto;
                            cursor: pointer;
                            object-fit: contain;
                        "
                    />
                </div>
            </div>
        </div>

        <div id="result-modal" class="screen-overlay" style="display: none">
            <div class="result-modal" role="dialog" aria-label="Í≤∞Í≥º">
                <div id="res-title" class="result-modal-title">FINISHED!</div>

                <div class="result-modal-body">
                    <div class="result-modal-row">
                        <span class="result-label">Ïù¥Î≤à ÌöçÎìù</span>
                        <span class="result-value gold">+<span id="res-gain">0</span> G</span>
                    </div>
                    <div class="result-modal-row">
                        <span class="result-label">Ïù¥Î≤à ÏÜêÏã§</span>
                        <span class="result-value danger">-<span id="res-lost">0</span> G</span>
                    </div>
                    <div class="result-modal-total">
                        ÎÇ¥ ÏßÄÍ∞ë Ï¥ùÏï°: <span id="res-current-total">0</span> G
                    </div>
                    <div id="res-record" class="result-record-container"></div>
                    <div id="res-wrong-words" class="result-wrong-words-container"></div>
                </div>

                <div class="result-modal-actions">
                    <button class="result-btn result-btn-gold" onclick="closeResultScreen()">
                        ÎßàÏùÑÎ°ú Í∑ÄÌôò
                    </button>
                </div>
            </div>
        </div>

        <div id="setting-modal" class="screen-overlay" style="display: none">
            <div id="password-modal" class="card rpg-modal">
                <div class="modal-header">
                    <h2 class="modal-title">ÎπÑÎ∞ÄÎ≤àÌò∏ ÏûÖÎ†•</h2>
                </div>
                <div class="modal-body">
                    <div
                        id="password-input-boxes"
                        style="display: flex; gap: 5px; justify-content: center; margin: 20px 0"
                    ></div>

                    <p id="password-error" style="color: var(--danger); display: none">
                        ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§.
                    </p>

                    <div
                        id="password-numpad"
                        style="
                            display: grid;
                            grid-template-columns: repeat(3, 1fr);
                            gap: 10px;
                            max-width: 200px;
                            margin: 0 auto;
                        "
                    >
                        <button class="num-btn" onclick="secret.enter(1)">1</button>

                        <button class="num-btn" onclick="secret.enter(2)">2</button>

                        <button class="num-btn" onclick="secret.enter(3)">3</button>

                        <button class="num-btn" onclick="secret.enter(4)">4</button>

                        <button class="num-btn" onclick="secret.enter(5)">5</button>

                        <button class="num-btn" onclick="secret.enter(6)">6</button>

                        <button class="num-btn" onclick="secret.enter(7)">7</button>

                        <button class="num-btn" onclick="secret.enter(8)">8</button>

                        <button class="num-btn" onclick="secret.enter(9)">9</button>

                        <button class="num-btn" onclick="secret.del()">‚å´</button>

                        <button class="num-btn" onclick="secret.enter(0)">0</button>

                        <button
                            class="num-btn"
                            onclick="secret.close()"
                            style="
                                width: 60px;
                                height: 60px;
                                font-size: 20px;
                                font-weight: bold;
                                cursor: pointer;
                                box-sizing: border-box;
                            "
                        >X</button>
                    </div>
                </div>
            </div>

            <div id="gold-adjuster-modal" class="card rpg-modal" style="display: none">
                <div class="modal-header">
                    <h2 class="modal-title">ÏÑ§Ï†ï</h2>
                </div>
                <div class="modal-body">
                    <div class="setting-option-row">
                        <label class="setting-checkbox-label">
                            <input type="checkbox" id="setting-music-play" checked />
                            <span>ÏùåÏïÖ Ïû¨ÏÉù</span>
                        </label>
                    </div>
                    <div class="setting-option-row">
                        <label class="setting-checkbox-label">
                            <input type="checkbox" id="setting-word-read" checked />
                            <span>Îã®Ïñ¥ Î∞îÎ°ú ÏùΩÍ∏∞</span>
                        </label>
                    </div>
                    <div style="text-align: center; width: 100%; margin-top: 20px">
                        <button
                            class="btn-main"
                            onclick="secret.openGoldEditModal()"
                            style="width: 80%; margin: 0 auto; display: block"
                        >
                            Í≥®Îìú ÏàòÏ†ï
                        </button>
                    </div>
                    <div style="text-align: center; width: 100%; margin-top: 10px">
                        <button
                            class="btn-main"
                            onclick="secret.openPrintDaySelect()"
                            style="width: 80%; margin: 0 auto; display: block"
                        >
                            Î¨∏Ï†ú Ï∂úÎ†•
                        </button>
                    </div>
                    <div style="text-align: center; width: 100%; margin-top: 10px">
                        <button
                            class="btn-main btn-danger"
                            onclick="secret.resetStatistics()"
                            style="width: 80%; margin: 0 auto; display: block"
                        >
                            ÌÜµÍ≥Ñ Ï¥àÍ∏∞Ìôî
                        </button>
                    </div>
                </div>
                <div class="modal-footer">
                    <img
                        src="images/title/exit_btn.webp"
                        alt="ÎÇòÍ∞ÄÍ∏∞"
                        onclick="secret.close()"
                        style="
                            width: 80%;
                            height: auto;
                            display: block;
                            margin: 0 auto;
                            cursor: pointer;
                            object-fit: contain;
                        "
                    />
                </div>
            </div>

            <div id="gold-edit-modal" class="card rpg-modal" style="display: none">
                <div class="modal-header">
                    <h2 class="modal-title">Í≥®Îìú ÏàòÏ†ï</h2>
                </div>
                <div class="modal-body">
                    <div class="gold-adjuster">
                        <div class="gold-adjust-label">ÌòÑÏû¨ Í≥®Îìú</div>

                        <div id="current-gold-edit-display" class="gold-display-box">0</div>

                        <div class="gold-adjust-label">ÏÑ§Ï†ïÌï† Í≥®Îìú</div>

                        <div class="gold-adjust-controls">
                            <button id="gold-edit-down" class="gold-arrow">‚ñº</button>

                            <div id="edit-gold-display" class="gold-display-box">0</div>

                            <button id="gold-edit-up" class="gold-arrow">‚ñ≤</button>
                        </div>
                    </div>

                    <div style="text-align: center; width: 100%">
                        <img
                            src="images/title/apply_btn.webp"
                            alt="Ï†ÅÏö©"
                            onclick="secret.applyGoldEdit()"
                            style="
                                width: 80%;
                                height: auto;
                                display: block;
                                margin: 0 auto;
                                cursor: pointer;
                                object-fit: contain;
                            "
                        />
                    </div>
                    <div style="text-align: center; width: 100%; margin-top: 10px">
                        <img
                            src="images/title/exit_btn.webp"
                            alt="ÎÇòÍ∞ÄÍ∏∞"
                            onclick="secret.closeGoldEditModal()"
                            style="
                                width: 80%;
                                height: auto;
                                display: block;
                                margin: 0 auto;
                                cursor: pointer;
                                object-fit: contain;
                            "
                        />
                    </div>
                </div>
            </div>

            <div id="print-day-select-modal" class="card rpg-modal" style="display: none">
                <div class="modal-header">
                    <h2 class="modal-title">Day ÏÑ†ÌÉù</h2>
                </div>
                <div class="modal-body">
                    <div style="margin: 20px 0">
                        <select
                            id="print-day-select"
                            class="btn-main"
                            style="width: 100%; padding: 10px; font-size: 16px"
                        >
                            <option value="">Day ÏÑ†ÌÉù...</option>
                        </select>
                    </div>
                    <!-- Î¨∏Ï†ú ÌÉÄÏûÖ ÎùºÎîîÏò§ Î≤ÑÌäº (Print Modal Ï†ÑÏö©) -->
                    <div id="print-question-type-group" class="print-radio-group">
                        <label class="print-radio-label">
                            <input
                                type="radio"
                                name="print-question-type"
                                value="objective"
                                class="print-radio"
                            />
                            <span class="print-radio-text">Í∞ùÍ¥ÄÏãù</span>
                        </label>
                        <label class="print-radio-label">
                            <input
                                type="radio"
                                name="print-question-type"
                                value="mixed"
                                checked
                                class="print-radio"
                            />
                            <span class="print-radio-text">ÌòºÌï©Ìòï</span>
                        </label>
                        <label class="print-radio-label">
                            <input
                                type="radio"
                                name="print-question-type"
                                value="subjective"
                                class="print-radio"
                            />
                            <span class="print-radio-text">Ï£ºÍ¥ÄÏãù</span>
                        </label>
                    </div>
                    <div style="text-align: center; width: 100%; margin-top: 20px">
                        <button
                            class="btn-main"
                            onclick="secret.generatePrintHTML()"
                            style="width: 80%; margin: 0 auto; display: block"
                        >
                            Ïù∏ÏáÑÏö© HTML ÏÉùÏÑ±
                        </button>
                    </div>
                    <div style="text-align: center; width: 100%; margin-top: 10px">
                        <img
                            src="images/title/exit_btn.webp"
                            alt="ÎÇòÍ∞ÄÍ∏∞"
                            onclick="secret.closePrintDaySelect()"
                            style="
                                width: 80%;
                                height: auto;
                                display: block;
                                margin: 0 auto;
                                cursor: pointer;
                                object-fit: contain;
                            "
                        />
                    </div>
                </div>
            </div>
        </div>

        <!-- Load data files first (wrapped as JavaScript variables to avoid CORS) -->

        <script src="data/game-data-1.js"></script>
        <script src="data/game-data-2.js"></script>
        <script src="data/game-data-3.js"></script>
        <!-- decoy words set (Ïú†ÏÇ¨ Îã®Ïñ¥ ÏßëÌï©) -->
        <script src="data/decoy-words-set.js"></script>
        <script src="data/items-data.js"></script>
        <script src="scripts/data-loader.js"></script>
        <script src="scripts/words.js"></script>
        <script src="scripts/items.js"></script>
        <script src="scripts/app.js" defer></script>

        <!-- Background Music -->
        <audio id="background-music" loop>
            <source src="data/background_music.mp3" type="audio/mpeg" />
        </audio>

        <script>
            // Background music Ï¥àÍ∏∞Ìôî (Í≤åÏûÑ Ï§ëÏóêÎßå Ïû¨ÏÉù)
            window.addEventListener('load', () => {
                const bgMusic = document.getElementById('background-music');
                if (bgMusic) {
                    bgMusic.volume = 0.5; // Î≥ºÎ•® Ï°∞Ï†à
                    // ÌÉÄÏù¥ÌãÄÏóêÏÑúÎäî Ïû¨ÏÉùÌïòÏßÄ ÏïäÏùå (Í≤åÏûÑ ÏãúÏûë Ïãú Ïû¨ÏÉù)
                }
            });

            // Î∞±Î≤ÑÌäº Ï≤òÎ¶¨ (Í≤åÏûÑ Ï§ë, ÏÉÅÏ†ê, Ïù∏Î≤§ÌÜ†Î¶¨ÏóêÏÑú ÏãúÏûë ÌôîÎ©¥ÏúºÎ°ú)
            let isGameScreen = false;
            let isShopScreen = false;
            let isInventoryScreen = false;
            let isStatisticsScreen = false;
            let isSettingScreen = false;

            // ÌôîÎ©¥ ÏÉÅÌÉú Ï∂îÏ†Å
            const gameScreen = document.getElementById('battle-mode-game');
            const shopScreen = document.getElementById('shop-modal');
            const inventoryScreen = document.getElementById('inventory-modal');
            const statisticsScreen = document.getElementById('statistics-modal');
            const settingScreen = document.getElementById('setting-modal');
            const startScreen = document.getElementById('title-screen');

            // MutationObserverÎ°ú ÌôîÎ©¥ ÏÉÅÌÉú Í∞êÏßÄ
            const observer = new MutationObserver(() => {
                isGameScreen = gameScreen.style.display !== 'none';
                isShopScreen = shopScreen.style.display !== 'none';
                isInventoryScreen = inventoryScreen.style.display !== 'none';
                isStatisticsScreen = statisticsScreen && statisticsScreen.style.display !== 'none';
                isSettingScreen = settingScreen && settingScreen.style.display !== 'none';
            });

            observer.observe(gameScreen, { attributes: true, attributeFilter: ['style'] });
            observer.observe(shopScreen, { attributes: true, attributeFilter: ['style'] });
            observer.observe(inventoryScreen, { attributes: true, attributeFilter: ['style'] });
            if (statisticsScreen) {
                observer.observe(statisticsScreen, {
                    attributes: true,
                    attributeFilter: ['style'],
                });
            }
            if (settingScreen) {
                observer.observe(settingScreen, { attributes: true, attributeFilter: ['style'] });
            }

            // Î∞±Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨ (Î™®Î∞îÏùº Î∏åÎùºÏö∞Ï†Ä)
            window.addEventListener('popstate', (e) => {
                const battleModeStoryScreen = document.getElementById('battle-mode-story-modal');
                const bossStoryScreen = document.getElementById('boss-mode-story-modal');
                const practiceModeModal = document.getElementById('practice-mode-modal');
                const battleModeModal = document.getElementById('battle-mode-modal');
                const resultScreen = document.getElementById('result-modal');
                const practiceMemorizationScreen = document.getElementById('practice-mode-game');

                const isPracticeModeStoryScreen = false; // practice-mode-screenÏùÄ Îçî Ïù¥ÏÉÅ ÏÇ¨Ïö©ÌïòÏßÄ ÏïäÏùå
                const isBattleModeStoryScreen =
                    battleModeStoryScreen &&
                    battleModeStoryScreen.style.display !== 'none' &&
                    battleModeStoryScreen.style.display !== '';
                const isBossStoryScreen =
                    bossStoryScreen &&
                    bossStoryScreen.style.display !== 'none' &&
                    bossStoryScreen.style.display !== '';
                const isPracticeModeModal =
                    practiceModeModal &&
                    practiceModeModal.style.display !== 'none' &&
                    practiceModeModal.style.display !== '';
                const isBattleModeModal =
                    battleModeModal &&
                    battleModeModal.style.display !== 'none' &&
                    battleModeModal.style.display !== '';
                const isResultScreen =
                    resultScreen &&
                    resultScreen.style.display !== 'none' &&
                    resultScreen.style.display !== '';
                const isPracticeMemorizationScreen =
                    practiceMemorizationScreen &&
                    practiceMemorizationScreen.style.display !== 'none' &&
                    practiceMemorizationScreen.style.display !== '';
                const printDaySelectModal = document.getElementById('print-day-select-modal');
                const isPrintDaySelectModal =
                    printDaySelectModal &&
                    printDaySelectModal.style.display !== 'none' &&
                    printDaySelectModal.style.display !== '';
                const goldEditModal = document.getElementById('gold-edit-modal');
                const isGoldEditModal =
                    goldEditModal &&
                    goldEditModal.style.display !== 'none' &&
                    goldEditModal.style.display !== '';
                const passwordModal = document.getElementById('password-modal');
                const isPasswordModal =
                    passwordModal &&
                    passwordModal.style.display !== 'none' &&
                    passwordModal.style.display !== '';

                // Î¨∏Ï†úÏ∂úÎ†• Î™®Îã¨ÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÏÑ§Ï†ï ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                if (isPrintDaySelectModal) {
                    if (
                        typeof secret !== 'undefined' &&
                        typeof secret.closePrintDaySelect === 'function'
                    ) {
                        secret.closePrintDaySelect();
                    }
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                    return; // Î¨∏Ï†úÏ∂úÎ†• Î™®Îã¨Îßå Ï≤òÎ¶¨ÌïòÍ≥† Ï¢ÖÎ£å
                }

                // Í≥®Îìú ÏàòÏ†ï Î™®Îã¨ÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ Í≥®Îìú Ï°∞Ï†ï ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                if (isGoldEditModal) {
                    if (
                        typeof secret !== 'undefined' &&
                        typeof secret.closeGoldEditModal === 'function'
                    ) {
                        secret.closeGoldEditModal();
                    }
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                    return; // Í≥®Îìú ÏàòÏ†ï Î™®Îã¨Îßå Ï≤òÎ¶¨ÌïòÍ≥† Ï¢ÖÎ£å
                }

                // ÎπÑÎ∞ÄÎ≤àÌò∏ Î™®Îã¨ÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÎÇòÍ∞ÄÍ∏∞Ï≤òÎüº ÏßÅÏ†Ñ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                if (isPasswordModal) {
                    if (typeof secret !== 'undefined' && typeof secret.close === 'function') {
                        secret.close();
                    }
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                    return; // ÎπÑÎ∞ÄÎ≤àÌò∏ Î™®Îã¨Îßå Ï≤òÎ¶¨ÌïòÍ≥† Ï¢ÖÎ£å
                }

                // ÏÉÅÏ†êÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÎÇòÍ∞ÄÍ∏∞Ï≤òÎüº ÌÉÄÏù¥ÌãÄ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                if (isShopScreen) {
                    if (typeof shop !== 'undefined' && typeof shop.close === 'function') {
                        shop.close();
                    }
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                    return; // ÏÉÅÏ†êÎßå Ï≤òÎ¶¨ÌïòÍ≥† Ï¢ÖÎ£å
                }

                // Ïù∏Î≤§ÌÜ†Î¶¨ÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÎÇòÍ∞ÄÍ∏∞Ï≤òÎüº ÌÉÄÏù¥ÌãÄ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                if (isInventoryScreen) {
                    if (typeof inventory !== 'undefined' && typeof inventory.close === 'function') {
                        inventory.close();
                    }
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                    return; // Ïù∏Î≤§ÌÜ†Î¶¨Îßå Ï≤òÎ¶¨ÌïòÍ≥† Ï¢ÖÎ£å
                }

                // ÌÜµÍ≥ÑÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÎÇòÍ∞ÄÍ∏∞Ï≤òÎüº ÌÉÄÏù¥ÌãÄ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                if (isStatisticsScreen) {
                    if (
                        typeof statistics !== 'undefined' &&
                        typeof statistics.close === 'function'
                    ) {
                        statistics.close();
                    }
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                    return; // ÌÜµÍ≥ÑÎßå Ï≤òÎ¶¨ÌïòÍ≥† Ï¢ÖÎ£å
                }

                // ÏÑ§Ï†ïÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÎÇòÍ∞ÄÍ∏∞Ï≤òÎüº ÌÉÄÏù¥ÌãÄ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞ (ÌïòÏúÑ Î™®Îã¨Ïù¥ ÏóÜÏùÑ ÎïåÎßå)
                if (
                    isSettingScreen &&
                    !isPrintDaySelectModal &&
                    !isGoldEditModal &&
                    !isPasswordModal
                ) {
                    if (typeof secret !== 'undefined' && typeof secret.close === 'function') {
                        secret.close();
                    }
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                    return; // ÏÑ§Ï†ïÎßå Ï≤òÎ¶¨ÌïòÍ≥† Ï¢ÖÎ£å
                }

                // Í≤∞Í≥º ÌôîÎ©¥ÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÎÇòÍ∞ÄÍ∏∞Ï≤òÎüº ÌÉÄÏù¥ÌãÄ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                if (isResultScreen) {
                    if (typeof closeResultScreen === 'function') {
                        closeResultScreen();
                    }
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                    return; // Í≤∞Í≥º ÌôîÎ©¥Îßå Ï≤òÎ¶¨ÌïòÍ≥† Ï¢ÖÎ£å
                }

                // Ïó∞Ïäµ Î™®Îìú Î™®Îã¨ÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÎÇòÍ∞ÄÍ∏∞Ï≤òÎüº ÌÉÄÏù¥ÌãÄ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                if (isPracticeModeModal) {
                    if (typeof closePracticeModal === 'function') {
                        closePracticeModal(false);
                    }
                    // title-screen ÌëúÏãú
                    const startScreen = document.getElementById('title-screen');
                    if (startScreen) {
                        startScreen.style.display = 'flex';
                        startScreen.style.zIndex = '';
                    }
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                    return; // Ïó∞Ïäµ Î™®Îìú Î™®Îã¨Îßå Ï≤òÎ¶¨ÌïòÍ≥† Ï¢ÖÎ£å
                }

                // Î∞∞ÌãÄ Î™®Îìú Î™®Îã¨ÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÎÇòÍ∞ÄÍ∏∞Ï≤òÎüº ÌÉÄÏù¥ÌãÄ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                if (isBattleModeModal && !isBattleModeStoryScreen) {
                    if (typeof closePracticeModal === 'function') {
                        closePracticeModal(false);
                    }
                    // title-screen ÌëúÏãú
                    const startScreen = document.getElementById('title-screen');
                    if (startScreen) {
                        startScreen.style.display = 'flex';
                        startScreen.style.zIndex = '';
                    }
                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                    return; // Î∞∞ÌãÄ Î™®Îìú Î™®Îã¨Îßå Ï≤òÎ¶¨ÌïòÍ≥† Ï¢ÖÎ£å
                }

                if (
                    isGameScreen ||
                    isPracticeModeStoryScreen ||
                    isBattleModeStoryScreen ||
                    isBossStoryScreen ||
                    isPracticeMemorizationScreen
                ) {
                    // Í≤åÏûÑ ÌôîÎ©¥ÏùÑ Îã´ÏùÑ Îïå ÌÉÄÏù¥Î®∏ Ï†ïÏßÄ Î∞è ÏÉÅÌÉú Î¶¨ÏÖã
                    if (isGameScreen && typeof game !== 'undefined') {
                        if (game.timer) {
                            clearInterval(game.timer);
                            game.timer = null;
                        }
                        game.isProcessing = false; // Í≤åÏûÑ ÏÉÅÌÉú Î¶¨ÏÖãÌïòÏó¨ Îã§Ïãú ÏãúÏûë Í∞ÄÎä•ÌïòÎèÑÎ°ù
                    }

                    // Í≤åÏûÑ ÌôîÎ©¥Ïù¥ Îã´Ìûê Îïå Î∞∞Í≤ΩÏùåÏïÖ Ï†ïÏßÄ
                    if (isGameScreen) {
                        const bgMusic = document.getElementById('background-music');
                        if (bgMusic && !bgMusic.paused) {
                            bgMusic.pause();
                            bgMusic.currentTime = 0; // Ï≤òÏùåÎ∂ÄÌÑ∞ Îã§Ïãú Ïû¨ÏÉùÎêòÎèÑÎ°ù Î¶¨ÏÖã
                        }
                    }

                    // Í≤åÏûÑ ÌôîÎ©¥Îßå Îã´Í∏∞
                    gameScreen.style.display = 'none';

                    // Î∞∞ÌãÄ Î™®Îìú Ïä§ÌÜ†Î¶¨ Î™®Îã¨ÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ Î∞∞ÌãÄ Î™®Îìú Î™®Îã¨Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                    if (isBattleModeStoryScreen) {
                        closeScreenOverlay('battle-mode-story-modal', false);
                        // title-screenÏùò z-indexÏôÄ displayÎ•º Ï°∞Ï†ïÌïòÏó¨ backdrop-filterÍ∞Ä ÏûëÎèôÌïòÎèÑÎ°ù Ìï®
                        const startScreen = document.getElementById('title-screen');
                        if (startScreen) {
                            startScreen.style.zIndex = '100'; // Î™®Îã¨(z-index: 200) Îí§Ïóê ÏúÑÏπò
                            startScreen.style.display = 'flex'; // ÌëúÏãúÎêòÏñ¥ ÏûàÏñ¥Ïïº backdrop-filterÍ∞Ä ÏûëÎèô
                        }
                        // Î∞∞ÌãÄ Î™®Îìú Î™®Îã¨ Ïó¥Í∏∞
                        if (typeof openBattleModeModal === 'function') {
                            openBattleModeModal();
                        }
                    } else {
                        // Îã§Î•∏ Ïä§ÌÜ†Î¶¨ Î™®Îã¨ÏùÄ ÏùºÎ∞òÏ†ÅÏúºÎ°ú Îã´Í∏∞
                        if (bossStoryScreen) {
                            bossStoryScreen.style.display = 'none';
                            bossStoryScreen.style.visibility = '';
                            bossStoryScreen.style.opacity = '';
                            bossStoryScreen.style.zIndex = '';
                            bossStoryScreen.style.pointerEvents = '';
                            bossStoryScreen.classList.remove('closing');
                        }
                    }

                    // Í≤åÏûÑ ÏÉÅÌÉú Î¶¨ÏÖã
                    if (
                        (isPracticeModeStoryScreen ||
                            isBattleModeStoryScreen ||
                            isBossStoryScreen) &&
                        typeof game !== 'undefined'
                    ) {
                        game.isProcessing = false;
                    }

                    // Ïó∞Ïäµ Î™®Îìú Í≤åÏûÑÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÌÉÄÏù¥ÌãÄ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                    if (practiceMemorizationScreen) {
                        practiceMemorizationScreen.style.display = 'none';
                        practiceMemorizationScreen.classList.remove('closing');
                    }

                    // Î≥¥Ïä§ Ïä§ÌÜ†Î¶¨ Î™®Îã¨ÏóêÏÑú Î∞±Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÌÉÄÏù¥ÌãÄ ÌôîÎ©¥ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                    if (bossStoryScreen) {
                        bossStoryScreen.style.display = 'none';
                        bossStoryScreen.style.visibility = '';
                        bossStoryScreen.style.opacity = '';
                        bossStoryScreen.style.zIndex = '';
                        bossStoryScreen.style.pointerEvents = '';
                        bossStoryScreen.classList.remove('closing');
                    }

                    // Í≤åÏûÑ ÌôîÎ©¥, Î≥¥Ïä§ Ïä§ÌÜ†Î¶¨ Î™®Îã¨, Ïó∞Ïäµ Î™®Îìú Í≤åÏûÑÏùº Îïå title-screen ÌëúÏãú
                    if (isGameScreen || isBossStoryScreen || isPracticeMemorizationScreen) {
                        startScreen.style.display = 'flex';
                        // z-index Î≥µÏõê
                        startScreen.style.zIndex = '';

                        // Î≤ÑÌäº Ïò§Î≤ÑÎ†àÏù¥ ÎèôÍ∏∞Ìôî (Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÌõÑ)
                        setTimeout(() => {
                            if (typeof syncTitleButtonOverlay === 'function') {
                                syncTitleButtonOverlay();
                            }
                        }, 100);
                    }

                    // ÌûàÏä§ÌÜ†Î¶¨ Ï°∞Ïûë Î∞©ÏßÄ
                    history.pushState(null, '', window.location.href);
                }
            });

            // Ï¥àÍ∏∞ ÌûàÏä§ÌÜ†Î¶¨ ÏÉÅÌÉú Ï∂îÍ∞Ä
            history.pushState(null, '', window.location.href);
        </script>
    </body>
</html>
